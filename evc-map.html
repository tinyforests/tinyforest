<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your EVC - Tiny Forests</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #map { height: 600px; width: 80%; margin: auto; }
        #search-container { margin: 10px 0; }
        input[type="text"] { padding: 8px; width: 300px; }
        button { padding: 8px 12px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h2>Find Your Ecological Vegetation Class</h2>
    <div id="search-container">
        <input type="text" id="addressInput" placeholder="Enter your address...">
        <button onclick="searchAddress()">Find My EVC</button>
    </div>
    <div id="map"></div>

    <script>
        var map = L.map('map').setView([-37.8136, 144.9631], 6); // Melbourne

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Add WMS EVC Layer
        var evcLayer = L.tileLayer.wms("https://opendata.maps.vic.gov.au/geoserver/wms", {
            layers: "open-data-platform:nv2005_evcbcs",
            format: "image/png",
            transparent: true,
            attribution: "© Victorian Government Open Data"
        }).addTo(map);

        var marker;

        // Function to search for an address
        function searchAddress() {
            var address = document.getElementById("addressInput").value;
            if (!address) return alert("Please enter an address.");

            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        var lat = parseFloat(data[0].lat);
                        var lon = parseFloat(data[0].lon);

                        map.setView([lat, lon], 12);
                        if (marker) map.removeLayer(marker);
                        marker = L.marker([lat, lon]).addTo(map);

                        getEVCData(lat, lon);
                    } else {
                        alert("Address not found.");
                    }
                })
                .catch(error => console.error("Error with geocoding:", error));
        }

        // Function to get EVC data from WFS
        function getEVCData(lat, lng) {
            var wfsUrl = `https://opendata.maps.vic.gov.au/geoserver/wfs?service=WFS&version=1.0.0&request=GetFeature&typeName=open-data-platform:nv2005_evcbcs&outputFormat=application/json&bbox=${lng-0.001},${lat-0.001},${lng+0.001},${lat+0.001},EPSG:4326`;

            fetch(wfsUrl)
                .th
